<!-- color-mode-toggle loader -->
<script type="text/javascript">

  console.log('_includes ColorModeToggle');

  class ColorModeToggle {
    static get MODE_KEY() {
      return 'color-mode';
    }
    static get MODE_ATTR() {
      return 'data-color-mode';
    }
    static get RAINBOW_MODE() {
      return 'rainbow';
    }
    static get NORMAL_MODE() {
      return 'normal';
    }
    static get ID() {
      return 'color-mode-toggle';
    }

    constructor() {
      if (this.hasMode) {
        if (this.isRainbowMode) {
          this.setRainbow();
        } else {
          this.setNormal();
        }
      }

      let self = this;

    } /* constructor() */

    get isRainbowMode() {
      return this.mode === ColorModeToggle.RAINBOW_MODE;
    }

    get isNormalMode() {
      return this.mode === ColorModeToggle.NORMAL_MODE;
    }

    get hasMode() {
      return this.mode != null;
    }

    get mode() {
      return sessionStorage.getItem(ColorModeToggle.MODE_KEY);
    }

    /* get the current mode on screen */
    get modeStatus() {
      if (this.isRainbowMode) {
        return ColorModeToggle.RAINBOW_MODE;
      } else {
        return ColorModeToggle.NORMAL_MODE;
      }
    }

    setRainbow() {

      console.log('setRainbow');

      document.documentElement.setAttribute(ColorModeToggle.MODE_ATTR, ColorModeToggle.RAINBOW_MODE);
      sessionStorage.setItem(ColorModeToggle.MODE_KEY, ColorModeToggle.RAINBOW_MODE);

      var $modus = Math.floor((Math.random() * 3) + 1);
      var $random = Math.floor((Math.random() * 230) + 40);

      document.addEventListener("mousemove", function(e) {
        var $width  = (document.body.clientHeight) / 255;
        var $height = (document.body.clientWidth) / 255;
        var $pageX  = parseInt(e.pageX / $width, 10);
        var $pageY  = parseInt(e.pageY / $height, 10);

        if ($modus == 1) {
          setColor($random, $pageY, $pageX);
        } else if ($modus == 2) {
          setColor($pageY, $random, $pageX);
        } else {
          setColor($pageX, $pageY, $random);
        }
      });

      // set rainbow-colors
      function setColor(C1, C2, C3) {

        $("h1").css("color", "rgb(" + C1 + "," + C2 + "," + C3 + ")");
        $("h2").css("color", "rgb(" + C1 + "," + C2 + "," + C3 + ")");
        $("h3").css("color", "rgb(" + C1 + "," + C2 + "," + C3 + ")");
        $("h4").css("color", "rgb(" + C1 + "," + C2 + "," + C3 + ")");
        $("a").css("color", "rgb(" + C1 + "," + C2 + "," + C3 + ")");
        $("button").css("color", "rgb(" + C1 + "," + C2 + "," + C3 + ")");
        $("i").css("color", "rgb(" + C1 + "," + C2 + "," + C3 + ")");
        $("strong").css("color", "rgb(" + C1 + "," + C2 + "," + C3 + ")");
        $("input").css("color", "rgb(" + C1 + "," + C2 + "," + C3 + ")");
      }
    }

    setNormal() {

      console.log('setNormal');
      document.removeEventListener("mousemove", function(){}, true);
      $(document).mousemove(function(e) {});


      document.documentElement.setAttribute(ColorModeToggle.MODE_ATTR, ColorModeToggle.NORMAL_MODE);
      sessionStorage.setItem(ColorModeToggle.MODE_KEY, ColorModeToggle.NORMAL_MODE);
    }

    clearMode() {

      console.log('clearMode');
      document.removeEventListener("mousemove", function(){}, true);

      $(document).mousemove(function(e) {});

      document.documentElement.removeAttribute(ColorModeToggle.MODE_ATTR);
      sessionStorage.removeItem(ColorModeToggle.MODE_KEY);
    }

    /* Notify another plugins that the theme mode has changed */
    notify() {

      console.log('notify');

      console.log('ColorModeToggle.ID: ' + ColorModeToggle.ID);
      console.log('this.modeStatus:   ' + this.modeStatus);


      window.postMessage(
        {
          direction: ColorModeToggle.ID,
          message: this.modeStatus
        },
        '*'
      );
    }

    flipMode() {

      console.log('flipMode this.hasMode: ' + this.hasMode);
      console.log('this.isNormalMode: ' + this.isNormalMode);
      console.log('this.isRainbowMode: ' + this.isRainbowMode);

      if (this.hasMode) {
        if (this.isRainbowMode) {
          this.setNormal();
        } else {
          this.setRainbow();
        }
      } else {
        this.setNormal();
      }

      this.notify();
    } /* flipMode() */
  } /* ColorModeToggle */

  const colorModeToggle = new ColorModeToggle();

  /**
   * Add listener for color mode toggle
   */

  function colorModeWatcher($colorToggle) {
    if ($colorToggle.length === 0) {
      return;
    }

    $colorToggle.off().on('click', (e) => {
      const $target = $(e.target);
      let $colorModeButton =
        $target.prop('tagName') === 'button'.toUpperCase()
          ? $target
          : $target.parent();

      colorModeToggle.flipMode(); // colorModeToggle: `_includes/color-mode-toggle.html`
      $colorModeButton.trigger('blur'); // remove the clicking outline
    });
  }

  document.addEventListener("DOMContentLoaded", function(event) {
  // window.onload = function () {

    const $colorToggle = $('.color-mode-toggle');
    colorModeWatcher($colorToggle);
  });
  // };

</script>
